<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover">
    <title>LocalStorage</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        html {
            box-sizing: border-box;
            background: url('http://wes.io/hx9M/oh-la-la.jpg') center no-repeat;
            background-size: cover;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-family: Futura, "Trebuchet MS", Arial, sans-serif;
        }

        *,
        *:before,
        *:after {
            box-sizing: inherit;
        }

        svg {
            fill: white;
            background: rgba(0, 0, 0, 0.1);
            padding: 20px;
            border-radius: 50%;
            width: 200px;
            margin-bottom: 50px;
        }

        .wrapper {
            padding: 20px;
            max-width: 350px;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 0 0 10px rgba(0, 0, 0, 0.1);
        }

        h2 {
            text-align: center;
            margin: 0;
            font-weight: 200;
        }

        .plates {
            margin: 0;
            padding: 0;
            text-align: left;
            list-style: none;
        }

        .plates li {
            border-bottom: 1px solid rgba(0, 0, 0, 0.2);
            padding: 10px 0;
            font-weight: 100;
            display: flex;
        }

        .plates label {
            flex: 1;
            cursor: pointer;
        }

        .plates input {
            display: none;
        }

        .plates input+label:before {
            content: 'â¬œ';
            margin-right: 10px;
        }

        .plates input:checked+label:before {
            content: 'ğŸŒ®';
        }

        .add-items {
            margin-top: 20px;
        }

        .add-items input {
            padding: 10px;
            outline: 0;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>
    <div class="wrapper">
        <h2>LOCAL TAPAS</h2>
        <ul class="plates">
            <li>Loading Taps...</li>
        </ul>
        <form class="add-items">
            <input type="text" name="item" placeholder="Item Name" required>
            <input type="submit" value="+ Add Item">
        </form>
    </div>

    <script>
        const addItems = document.querySelector('.add-items'); // form
        const itemsList = document.querySelector('.plates'); // ul

        // åˆå§‹åŒ– items æ•°ç»„ï¼Œä» localStorage ä¸­è¯»å–æ•°æ®
        let items = JSON.parse(localStorage.getItem('items')) || [];
        // JSON.parse() å‡½æ•°å°† JSON å­—ç¬¦ä¸²è½¬æ¢ä¸º JavaScript æ•°ç»„æˆ–å¯¹è±¡ã€‚

        // æ¯æ¬¡æ›´æ–° items æ•°ç»„æ—¶ï¼Œä¿å­˜åˆ° localStorage
        function saveItemsToLocalStorage() {
            localStorage.setItem('items', JSON.stringify(items));
        }

        // æ·»åŠ æ–°é¡¹ç›®
        function addItem(e) {
            e.preventDefault();

            // è·å–è¾“å…¥æ¡†çš„å€¼å¹¶å»é™¤ç©ºç™½å­—ç¬¦
            const text = (this.querySelector('[name=item]')).value.trim();

            // å¦‚æœè¾“å…¥ä¸ºç©ºï¼Œç»™å‡ºæç¤ºå¹¶è¿”å›
            if (text === '') {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„é¡¹ç›®åç§°');
                return;
            }

            // åˆ›å»ºæ–°é¡¹ç›®
            const item = {
                text,
                done: false
            };

            // æ·»åŠ åˆ° items æ•°ç»„
            items.push(item);

            // ä¿å­˜åˆ° localStorage å¹¶æ›´æ–° UI
            saveItemsToLocalStorage();
            populaList(items, itemsList);

            // æ¸…ç©ºè¾“å…¥æ¡†
            this.reset();
        }

        // æ¸²æŸ“ul  
        function populaList(items, platesList) {
            platesList.innerHTML = items.map((item, i) => {
                return `
                <li>
                    <input type="checkbox" data-index="${i}" id="item${i}" ${item.done ? 'checked' : ''}>
                    <label for="item${i}" class="${item.done ? 'done' : ''}">${item.text}</label>
                </li>
                `;
            }).join('');
            //æµè§ˆå™¨ä¼šè°ƒç”¨æ•°ç»„çš„ toString() æ–¹æ³•ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œæ•°ç»„çš„ toString() æ–¹æ³•ä¼šå°†æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ç”¨é€—å· , åˆ†éš”ï¼Œå¹¶è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚
            //å› æ­¤ï¼ŒplatesList.innerHTML ä¼šæ¥æ”¶åˆ°ç±»ä¼¼ "<li>...</li>,<li>...</li>,<li>...</li>" çš„å­—ç¬¦ä¸²ã€‚
        }

        // ç›‘å¬å¤é€‰æ¡†çš„å˜åŒ–ï¼Œæ›´æ–° items æ•°ç»„ä¸­çš„ done çŠ¶æ€
        itemsList.addEventListener('change', function (e) {
            if (e.target.type === 'checkbox') {
                const index = parseInt(e.target.getAttribute('data-index'), 10);

                // éªŒè¯ç´¢å¼•æ˜¯å¦æœ‰æ•ˆ
                if (!isNaN(index) && index >= 0 && index < items.length) {
                    items[index].done = e.target.checked;

                    // ä¿å­˜åˆ° localStorage å¹¶æ›´æ–° UI
                    saveItemsToLocalStorage();
                    populaList(items, itemsList);
                } else {
                    console.warn('æ— æ•ˆçš„ç´¢å¼•:', index);
                }
            }
        });

        // åˆå§‹åŒ–é¡µé¢æ—¶åŠ è½½å·²æœ‰çš„æ•°æ®
        function init() {
            populaList(items, itemsList);
        }

        // è°ƒç”¨ init å‡½æ•°
        init();

        // ç›‘å¬è¡¨å•æäº¤äº‹ä»¶
        addItems.addEventListener('submit', addItem);
    </script>
</body>

</html>